<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.4 on Fri Jul 29 15:39:41 2016 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>readparam.pro (Documentation for jbiu/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="readparam.pro (Documentation for jbiu/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;    READPARAM</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;    Reads in a parameter file containing "key = value" pairs.</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;    I/O</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;    Result = READPARAM(Filename)</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;    Filename:    Name of parameter file.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;    Returns a structure that has one element for each line in the file. The first</span>
<span class="comments">;    character of the file specifies the type: a for string, b for boolean,</span>
<span class="comments">;    i or n for integer, and d for double. # is a comment character.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;    FIXME</span>
<span class="comments">;</span>
<span class="comments">; REQUIRES:</span>
<span class="comments">;    Craig Markwardt's hashtable object (http://www.physics.wisc.edu/~craigm/idl/down/hashtable__define.pro).</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;    Written by: Jeremy Bailin</span>
<span class="comments">;    Lost in history: Was once written and then lost?!</span>
<span class="comments">;    23 May 2011   Re-written</span>
<span class="comments">;    26 May 2011   Added OBJ_DESTROY.</span>
<span class="comments">;-</span>
<a id="readparam:source"></a>function readparam, filename

nlines = file_lines(filename)
lines = strarr(nlines)

openr,lun,filename,/get_lun
readf,lun,lines
free_lun,lun

<span class="comments">; create a hash table (http://www.physics.wisc.edu/~craigm/idl/down/hashtable__define.pro)</span>
<span class="comments">; to contain the key/value pairs</span>
ht = obj_new('hashtable')

for i=0l,nlines-1 do begin
  <span class="comments">; strip out comments</span>
  hashpos = strpos(lines[i], '#')
  if hashpos gt -1 then lines[i]=strmid(lines[i],0,hashpos+1)

  <span class="comments">; use stregex to see if it matches a normal line and to find the key and value</span>
  tab=string(9b)
  rematch = stregex(lines[i], '^[ '+tab+']*([a-zA-Z0-9]+)[ '+tab+']*=[ '+tab+']*([^ '+tab+']+)', /subexpr, /extract)
  if rematch[0] ne '' then begin
    <span class="comments">; it matched</span>
    case strmid(rematch[1], 0, 1) of
      'a': val=rematch[2]
      'b': val=(rematch[2] ne 0)
      'i': val=long(rematch[2])
      'n': val=long(rematch[2])
      'd': val=double(rematch[2])
    endcase
    <span class="comments">; add to hashtable</span>
    ht->add, rematch[1], val
  endif
endfor

<span class="comments">; turn the hashtable into a structure</span>
nht = ht->count()
if nht eq 0 then message, 'No key/value pairs found in file.'
outstruct = ht->struct()
obj_destroy, ht

return, outstruct
  
end


</code>
    </div>
  </body>
</html>