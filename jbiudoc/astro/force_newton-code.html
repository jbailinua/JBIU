<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.4 on Fri Jul 29 15:39:39 2016 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>force_newton.pro (Documentation for jbiu/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="force_newton.pro (Documentation for jbiu/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       FORCE_NEWTON</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Calculates the gravitational force from a particle distribution</span>
<span class="comments">;       at a list of positions.</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;       Astro</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       Result = FORCE_NEWTON(X, Y, Z, Xpart, Ypart, Zpart, Mass)</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       X:     X coordinates at which to calculate forces.</span>
<span class="comments">;</span>
<span class="comments">;       Y:     Y coordinates at which to calculate forces.</span>
<span class="comments">;</span>
<span class="comments">;       Z:     Z coordinates at which to calculate forces.</span>
<span class="comments">;</span>
<span class="comments">;       Xpart: X coordinates of particle positions defining the mass</span>
<span class="comments">;              distribution.</span>
<span class="comments">;</span>
<span class="comments">;       Ypart: Y coordinates of particle positions defining the mass</span>
<span class="comments">;              distribution.</span>
<span class="comments">;</span>
<span class="comments">;       Zpart: Z coordinates of particle positions defining the mass</span>
<span class="comments">;              distribution.</span>
<span class="comments">;</span>
<span class="comments">;       Mass:  Mass of each particle.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">;       LENGTHUNIT: Length unit, in cm (or kpc if /ASTRO is set). Default: 1kpc.</span>
<span class="comments">;</span>
<span class="comments">;       MASSUNIT:   Mass unit, in grams (or solar masses if /ASTRO is</span>
<span class="comments">;                   set). Default: 1 solar mass.</span>
<span class="comments">;</span>
<span class="comments">;       SOFTENING:  Plummer softening length. Default: 0 (no softening).</span>
<span class="comments">;</span>
<span class="comments">;       ASTRO:      If /ASTRO is set then LENGTHUNIT and MASSUNIT are given</span>
<span class="comments">;                   in kpc and solar masses respectively, otherwise they are</span>
<span class="comments">;                   in CGS (Lengthunit in cm, Massunit in grams).</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       This function returns the gravitational force at each X,Y,Z position.</span>
<span class="comments">;       If there are NPOS positions, Result is an NPOSx3 matrix.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Calculate the gravitational force on a line along the x-axis from</span>
<span class="comments">;       6 point masses placed at the vertices of a cube:</span>
<span class="comments">;</span>
<span class="comments">;       xmasspos = [-1,-1,-1,-1,1,1,1,1]</span>
<span class="comments">;       ymasspos = [-1,-1,1,1,-1,-1,1,1]</span>
<span class="comments">;       zmasspos = [-1,1,-1,1,-1,1,-1,1]</span>
<span class="comments">;       masses = REPLICATE(1.,8)</span>
<span class="comments">;       xlinepos = 0.1*FINDGEN(20)</span>
<span class="comments">;       ylinepos = REPLICATE(0.,20)</span>
<span class="comments">;       zlinepos = REPLICATE(0.,20)</span>
<span class="comments">;       forces = FORCE_NEWTON(xlinepos, ylinepos, zlinepos, xmasspos, ymasspos,</span>
<span class="comments">;         zmasspos, masses)</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written by:    Jeremy Bailin</span>
<span class="comments">;       10 June 2008   Public release in JBIU</span>
<span class="comments">;</span>
<span class="comments">;-</span>
<a id="force_newton:source"></a>function force_newton, x, y, z, xpart, ypart, zpart, mass, $
  lengthunit=lengthunit, massunit=massunit, astro=astro_units, softening=given_eps

<span class="comments">; copied from astroconst.idl to reduce dependencies:</span>
A_pc = 3.08567758d18
A_msun = 1.9889d33
A_G = 6.673d-8


npart = n_elements(xpart)
npos = n_elements(x)

if n_elements(y) ne npos then message, 'X, Y, and Z must have the same number of elements.'
if n_elements(z) ne npos then message, 'X, Y, and Z must have the same number of elements.'
if n_elements(ypart) ne npart then message, 'XPART, YPART, and ZPART must have the same number of elements.'
if n_elements(zpart) ne npart then message, 'XPART, YPART, and ZPART must have the same number of elements.'
if n_elements(mass) ne npart then message, 'MASS must have the same number of elements as XPART.'



if n_elements(lengthunit) eq 0 then lengthunit=1e3*A_pc else begin
  if keyword_set(astro) then lengthunit*=1e3*A_pc
endelse
if n_elements(massunit) eq 0 then massunit=A_msun else begin
  if keyword_set(astro) then massunit*=A_msun
endelse


if n_elements(given_eps) eq 0 then eps=0. else eps=double(given_eps)
eps *= lengthunit


xdiff = double(rebin(reform(x*lengthunit,npos,1),npos,npart) - $
  rebin(reform(xpart*lengthunit,1,npart),npos,npart))
ydiff = double(rebin(reform(y*lengthunit,npos,1),npos,npart) - $
  rebin(reform(ypart*lengthunit,1,npart),npos,npart))
zdiff = double(rebin(reform(z*lengthunit,npos,1),npos,npart) - $
  rebin(reform(zpart*lengthunit,1,npart),npos,npart))
rdiff = sqrt(xdiff^2 + ydiff^2 + zdiff^2)
notitself = where(rdiff ne 0.)
xdiff[notitself] /= rdiff[notitself]
ydiff[notitself] /= rdiff[notitself]
zdiff[notitself] /= rdiff[notitself]
rdiff2 = reform(temporary(rdiff^2) + eps^2,npos,npart)

forcex = - A_G * total(reform(xdiff,npos,npart) * reform(rebin(reform(mass*massunit,1,npart),npos,npart),npos,npart) / rdiff2, 2)
forcey = - A_G * total(reform(ydiff,npos,npart) * reform(rebin(reform(mass*massunit,1,npart),npos,npart),npos,npart) / rdiff2, 2)
forcez = - A_G * total(reform(zdiff,npos,npart) * reform(rebin(reform(mass*massunit,1,npart),npos,npart),npos,npart) / rdiff2, 2)

return, [[forcex],[forcey],[forcez]]

end

</code>
    </div>
  </body>
</html>